<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EduQuest — Student</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--maroon:#7a0b0b;--accent:#2b6da3;--glass:rgba(255,255,255,0.04);--muted:rgba(255,255,255,0.75)}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial}
body{margin:0;background:linear-gradient(180deg,#041225,#071427);color:#fff;min-height:100vh}
.container{max-width:900px;margin:36px auto;padding:20px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.head{display:flex;align-items:center;gap:12px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--maroon),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:800}
.back{margin-left:auto;background:transparent;border:none;color:#fff;cursor:pointer}
.form{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px}
input,select{padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:#fff}
.btn{padding:10px 14px;border-radius:8px;border:none;background:var(--maroon);cursor:pointer;color:#fff;font-weight:700}
.qcard{margin-top:18px;padding:14px;border-radius:10px;background:var(--glass)}
.choice{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);margin-top:8px;cursor:pointer}
.choice.correct{background:#165c2a}
.choice.wrong{background:#7a1b1b}
.footer{margin-top:12px;color:var(--muted)}
@media(max-width:760px){.form{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="head">
    <div class="logo">EQ</div>
    <div>
      <div style="font-weight:800">EduQuest — Student</div>
      <div style="font-size:13px;color:var(--muted)">Enter your details and take the quiz</div>
    </div>
    <button class="back" onclick="location.href='index.html'">← Home</button>
  </div>

  <div id="step1">
    <div class="form">
      <input id="sName" placeholder="Full name">
      <input id="sGrade" placeholder="Grade (e.g. 10)">
      <input id="sSection" placeholder="Section (e.g. A)">
      <input id="sDate" type="date">
    </div>
    <div style="margin-top:12px">
      <button class="btn" id="startBtn">Start Quiz</button>
      <button class="btn" id="historyBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);margin-left:8px">View Results</button>
    </div>
  </div>

  <div id="quizArea" style="display:none">
    <div id="studentMeta" style="margin-top:10px;color:var(--muted)"></div>
    <div class="qcard" id="qcard"></div>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn" id="prevBtn" style="display:none">Previous</button>
      <button class="btn" id="nextBtn" style="display:none">Next</button>
      <button class="btn" id="finishBtn" style="display:none;background:#2b6da3">Finish</button>
      <button class="btn" id="exportBtn" style="display:none;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Export Result</button>
    </div>
  </div>

  <div id="history" style="display:none;margin-top:14px">
    <h3>Previous Results</h3>
    <div id="historyList" style="max-height:260px;overflow:auto"></div>
    <div style="margin-top:8px"><button class="btn" onclick="clearHistory()" style="background:#a22">Clear History</button></div>
  </div>

  <div class="footer">All data saved locally. Export CSV to share results.</div>
</div>

<script>
const QUIZ_KEY='edu_quiz_v1';
const RESULTS_KEY='edu_results_v1';

let questions = JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]');
let state = { idx:0, answers:[] };
const startBtn = document.getElementById('startBtn');
const qcard = document.getElementById('qcard');

function refreshQuestions(){ questions = JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]'); }
refreshQuestions();

startBtn.addEventListener('click', ()=>{
  const name = document.getElementById('sName').value.trim();
  const grade = document.getElementById('sGrade').value.trim();
  const section = document.getElementById('sSection').value.trim();
  const date = document.getElementById('sDate').value;
  if(!name||!grade||!section||!date) return alert('Complete all fields.');
  if(!questions.length) return alert('No quiz available — ask admin to add questions.');

  state.student = { name, grade, section, date };
  state.idx = 0; state.answers = Array(questions.length).fill(null);
  document.getElementById('step1').style.display='none';
  document.getElementById('quizArea').style.display='block';
  document.getElementById('studentMeta').innerText = `${name} • Grade ${grade} • ${section} • ${date}`;
  showQuestion();
});

function showQuestion(){
  const q = questions[state.idx];
  qcard.innerHTML = `<div style="font-weight:700">${state.idx+1}. ${q.question}</div>`;
  q.choices = q.choices || [q.a||'', q.b||'', q.c||'', q.d||''];
  q.choices.forEach((ch,i)=>{
    const div = document.createElement('div'); div.className='choice'; div.innerText = `${String.fromCharCode(65+i)}. ${ch}`;
    div.onclick = ()=> select(i);
    qcard.appendChild(div);
  });
  // controls
  document.getElementById('prevBtn').style.display = state.idx>0 ? 'inline-block' : 'none';
  document.getElementById('nextBtn').style.display = state.idx < questions.length-1 ? 'inline-block' : 'none';
  document.getElementById('finishBtn').style.display = state.idx === questions.length-1 ? 'inline-block' : 'none';
  document.getElementById('exportBtn').style.display = 'none';
  document.getElementById('history').style.display='none';
}

function select(choice){
  if(state.answers[state.idx] !== null) return; // lock first answer
  state.answers[state.idx] = choice;
  const q = questions[state.idx];
  const nodes = qcard.querySelectorAll('.choice');
  nodes.forEach((n,i)=>{ n.style.pointerEvents='none'; if(i === choice && String.fromCharCode(65+i) !== q.correct) n.classList.add('wrong'); if(String.fromCharCode(65+i) === q.correct) n.classList.add('correct'); });
  // show explanation
  const expl = document.createElement('div'); expl.style.marginTop='10px'; expl.style.color='rgba(255,255,255,0.9)'; expl.innerHTML = `<strong>Explanation:</strong> ${q.explain || '—'}`;
  qcard.appendChild(expl);
  // if last question, show export
  document.getElementById('exportBtn').style.display = 'inline-block';
}

document.getElementById('prevBtn').addEventListener('click', ()=>{ if(state.idx>0){ state.idx--; showQuestion(); }});
document.getElementById('nextBtn').addEventListener('click', ()=>{ if(state.idx < questions.length-1){ state.idx++; showQuestion(); }});
document.getElementById('finishBtn').addEventListener('click', finish);

function finish(){
  const total = questions.length;
  const correct = state.answers.reduce((acc,ans,i)=> acc + ((ans !== null && String.fromCharCode(65+ans) === questions[i].correct)?1:0), 0);
  // save result
  const results = JSON.parse(localStorage.getItem(RESULTS_KEY)||'[]');
  const record = {
    name: state.student.name,
    grade: state.student.grade,
    section: state.student.section,
    date: state.student.date,
    score: correct,
    total,
    timestamp: new Date().toISOString()
  };
  results.push(record); localStorage.setItem(RESULTS_KEY, JSON.stringify(results));
  // show score
  qcard.innerHTML = `<div style="font-weight:700">Quiz Complete</div><div style="margin-top:12px">${record.name} • ${record.grade} • ${record.section} • ${record.date}</div>
    <div style="margin-top:12px;font-size:18px">Score: <strong>${correct}</strong> / ${total}</div>`;
  document.getElementById('prevBtn').style.display='none'; document.getElementById('nextBtn').style.display='none'; document.getElementById('finishBtn').style.display='none';
  document.getElementById('exportBtn').style.display='inline-block';
}

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const results = JSON.parse(localStorage.getItem(RESULTS_KEY)||'[]');
  if(!results.length) return alert('No results yet.');
  // export last result
  const last = results[results.length-1];
  const csv = `Name,Grade,Section,Date,Score,Total,Timestamp\n"${last.name}","${last.grade}","${last.section}","${last.date}",${last.score},${last.total},"${last.timestamp}"\n`;
  const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download = `eduquest_${last.name.replace(/\s+/g,'_')}.csv`; a.click();
});

document.getElementById('historyBtn').addEventListener('click', showHistory);
function showHistory(){
  const results = JSON.parse(localStorage.getItem(RESULTS_KEY)||'[]');
  const list = document.getElementById('historyList'); list.innerHTML='';
  if(!results.length){ list.innerHTML = '<div class="small" style="color:var(--muted)">No results yet</div>'; document.getElementById('history').style.display='block'; return; }
  results.slice().reverse().forEach(r=>{
    const el = document.createElement('div'); el.className='qcard'; el.style.marginTop='8px';
    el.innerHTML = `<div style="font-weight:700">${r.name}</div><div style="font-size:13px;margin-top:6px">${r.grade} • ${r.section} • ${r.date}</div>
      <div style="margin-top:6px">Score: ${r.score}/${r.total} • ${new Date(r.timestamp).toLocaleString()}</div>`;
    list.appendChild(el);
  });
  document.getElementById('history').style.display='block';
}

function clearHistory(){
  if(!confirm('Clear saved results?')) return;
  localStorage.removeItem(RESULTS_KEY); showHistory();
}
</script>
</body>
</html>
