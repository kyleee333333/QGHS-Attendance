<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EduQuest — Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--maroon:#7a0b0b;--accent:#2b6da3;--glass:rgba(255,255,255,0.04);--muted:rgba(255,255,255,0.75)}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial}
body{margin:0;background:linear-gradient(180deg,#071427,#041225);color:#fff;min-height:100vh}
.container{max-width:1100px;margin:36px auto;padding:20px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.header{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--maroon),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:800}
.title{font-weight:700}
.toolbar{margin-left:auto;display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:var(--maroon);color:#fff}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.grid{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
.card{background:var(--glass);padding:12px;border-radius:10px}
label{display:block;margin-top:10px;font-weight:600}
input,textarea,select{width:100%;padding:10px;margin-top:6px;border:none;border-radius:8px;background:rgba(255,255,255,0.02);color:#fff}
.small{font-size:13px;color:var(--muted)}
.list{margin-top:12px;max-height:420px;overflow:auto;padding-right:6px}
.q{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
.controls{display:flex;gap:8px;margin-top:12px}
.back{position:fixed;left:18px;top:18px;background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer}
.footer{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}
@media(max-width:900px){.grid{grid-template-columns:1fr} .toolbar{display:none}}
</style>
</head>
<body>
<button class="back" onclick="location.href='index.html'">←</button>
<div class="container">
  <div class="header">
    <div class="logo">EQ</div>
    <div>
      <div class="title">EduQuest — Admin</div>
      <div class="small">Create profiles • manage quizzes • export/import</div>
    </div>
    <div class="toolbar">
      <button class="btn btn-ghost" id="importBtn">Import JSON</button>
      <input type="file" id="importFile" accept=".json" style="display:none">
      <button class="btn btn-ghost" id="exportBtn">Export JSON</button>
    </div>
  </div>

  <div class="grid">
    <!-- left column: profiles & login -->
    <div class="card">
      <h3 style="margin:0">Profiles</h3>
      <div class="small" style="margin-top:6px">Create teacher profiles (local only). Passwords are private to this browser.</div>

      <label>Full name</label>
      <input id="pName" placeholder="Jane Teacher">

      <label>Password</label>
      <input id="pPass" type="password" placeholder="Create password">

      <div class="controls">
        <button class="btn btn-primary" id="createProfile">Create</button>
        <button class="btn btn-ghost" id="clearProfiles">Clear All</button>
      </div>

      <div style="margin-top:14px">
        <label>Sign in</label>
        <select id="profileSelect"></select>
        <input id="signPass" type="password" placeholder="Password">
        <div class="controls">
          <button class="btn btn-primary" id="signIn">Sign in</button>
        </div>
      </div>

      <div class="list" id="profilesList" aria-live="polite"></div>
    </div>

    <!-- right column: quiz manager -->
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <h3 id="panelTitle" style="margin:0">Please sign in</h3>
          <div class="small" id="signedBy">Not signed in</div>
        </div>
        <div id="signedControls" style="display:none">
          <button class="btn btn-ghost" id="downloadResults">Download Results</button>
        </div>
      </div>

      <div id="managerArea" style="display:none">
        <label>Question</label>
        <textarea id="qText" rows="2" placeholder="Type the question"></textarea>

        <label>Choices</label>
        <input id="qA" placeholder="Choice A">
        <input id="qB" placeholder="Choice B">
        <input id="qC" placeholder="Choice C">
        <input id="qD" placeholder="Choice D">

        <label>Correct (A/B/C/D)</label>
        <input id="qCorrect" maxlength="1">

        <label>Explanation</label>
        <textarea id="qExplain" rows="2" placeholder="Short explanation shown to students"></textarea>

        <div class="controls">
          <button class="btn btn-primary" id="addQ">Add question</button>
          <button class="btn btn-ghost" id="clearQs">Clear questions</button>
        </div>

        <div class="list" id="qList"></div>
      </div>

      <div class="footer">All data saved locally in this browser (localStorage).</div>
    </div>
  </div>
</div>

<script>
/* storage keys */
const ADMIN_KEY = 'edu_admins_v1';
const QUIZ_KEY = 'edu_quiz_v1';
const RESULTS_KEY = 'edu_results_v1';

/* profiles handling */
function loadProfiles(){
  const arr = JSON.parse(localStorage.getItem(ADMIN_KEY) || '[]');
  const sel = document.getElementById('profileSelect'); sel.innerHTML = '<option value="">Select</option>';
  const list = document.getElementById('profilesList'); list.innerHTML = '';
  arr.forEach((p,i)=>{
    const opt = document.createElement('option'); opt.value=i; opt.innerText = p.name; sel.appendChild(opt);
    const div = document.createElement('div'); div.className='q';
    div.innerHTML = `<strong>${p.name}</strong> <div style="margin-top:6px;font-size:13px;color:rgba(255,255,255,0.7)">${p.notes||''}</div>
    <div style="margin-top:6px"><button onclick="deleteProfile(${i})" class="btn btn-ghost">Delete</button></div>`;
    list.appendChild(div);
  });
}
loadProfiles();

document.getElementById('createProfile').addEventListener('click', ()=>{
  const name = document.getElementById('pName').value.trim();
  const pass = document.getElementById('pPass').value;
  if(!name||!pass) return alert('Fill name & password.');
  const arr = JSON.parse(localStorage.getItem(ADMIN_KEY)||'[]');
  if(arr.some(x=>x.name===name)) return alert('Profile exists.');
  arr.push({name,pass});
  localStorage.setItem(ADMIN_KEY, JSON.stringify(arr));
  document.getElementById('pName').value=''; document.getElementById('pPass').value='';
  loadProfiles();
});

function deleteProfile(i){
  if(!confirm('Delete profile?')) return;
  const arr = JSON.parse(localStorage.getItem(ADMIN_KEY)||'[]');
  arr.splice(i,1);
  localStorage.setItem(ADMIN_KEY, JSON.stringify(arr));
  loadProfiles();
}
document.getElementById('clearProfiles').addEventListener('click', ()=>{
  if(confirm('Clear all profiles?')){ localStorage.removeItem(ADMIN_KEY); loadProfiles(); }
});

/* sign in */
let activeAdmin = null;
document.getElementById('signIn').addEventListener('click', ()=>{
  const idx = document.getElementById('profileSelect').value;
  const pass = document.getElementById('signPass').value;
  if(idx==='') return alert('Choose a profile.');
  const arr = JSON.parse(localStorage.getItem(ADMIN_KEY)||'[]');
  const profile = arr[idx];
  if(!profile || profile.pass !== pass) return alert('Invalid password.');
  activeAdmin = profile; document.getElementById('panelTitle').innerText = 'Welcome, ' + profile.name;
  document.getElementById('signedBy').innerText = 'Signed in: ' + profile.name;
  document.getElementById('managerArea').style.display='block';
  document.getElementById('signedControls').style.display='block';
  refreshQs();
});

/* quiz management */
function refreshQs(){
  const data = JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]');
  const list = document.getElementById('qList'); list.innerHTML = '';
  if(data.length===0){ list.innerHTML = '<div class="small">No questions yet</div>'; return; }
  data.forEach((q,i)=>{
    const el = document.createElement('div'); el.className='q';
    el.innerHTML = `<strong>${i+1}. ${q.question}</strong>
      <div style="margin-top:6px;font-size:13px">A) ${q.choices[0]} • B) ${q.choices[1]} • C) ${q.choices[2]} • D) ${q.choices[3]}</div>
      <div style="margin-top:6px;font-size:13px;color:rgba(255,255,255,0.7)">Answer: ${q.correct} • By: ${q.author||'—'}</div>
      <div style="margin-top:6px"><button onclick="deleteQ(${i})" class="btn btn-ghost">Delete</button></div>`;
    list.appendChild(el);
  });
}
document.getElementById('addQ').addEventListener('click', ()=>{
  if(!activeAdmin) return alert('Sign in first.');
  const q = document.getElementById('qText').value.trim();
  const a = document.getElementById('qA').value.trim();
  const b = document.getElementById('qB').value.trim();
  const c = document.getElementById('qC').value.trim();
  const d = document.getElementById('qD').value.trim();
  const correct = document.getElementById('qCorrect').value.trim().toUpperCase();
  const explain = document.getElementById('qExplain').value.trim();
  if(!q||!a||!b||!c||!d||!correct) return alert('Fill all fields.');
  const arr = JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]');
  arr.push({question:q, choices:[a,b,c,d], correct, explain, author: activeAdmin.name});
  localStorage.setItem(QUIZ_KEY, JSON.stringify(arr));
  document.querySelectorAll('#qText,#qA,#qB,#qC,#qD,#qCorrect,#qExplain').forEach(e=>e.value='');
  refreshQs();
});
function deleteQ(i){
  if(!confirm('Delete this question?')) return;
  const arr = JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]'); arr.splice(i,1);
  localStorage.setItem(QUIZ_KEY, JSON.stringify(arr)); refreshQs();
}
document.getElementById('clearQs').addEventListener('click', ()=>{
  if(!confirm('Clear all questions?')) return;
  localStorage.removeItem(QUIZ_KEY); refreshQs();
});

/* export & import */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const payload = {
    admins: JSON.parse(localStorage.getItem(ADMIN_KEY)||'[]'),
    quiz: JSON.parse(localStorage.getItem(QUIZ_KEY)||'[]'),
    results: JSON.parse(localStorage.getItem(RESULTS_KEY)||'[]')
  };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'eduquest_backup.json'; a.click();
});
document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
document.getElementById('importFile').addEventListener('change', (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader(); r.onload = ()=> {
    try{
      const obj = JSON.parse(r.result);
      if(obj.admins) localStorage.setItem(ADMIN_KEY, JSON.stringify(obj.admins));
      if(obj.quiz) localStorage.setItem(QUIZ_KEY, JSON.stringify(obj.quiz));
      if(obj.results) localStorage.setItem(RESULTS_KEY, JSON.stringify(obj.results));
      alert('Imported successfully'); loadProfiles(); refreshQs();
    }catch(err){ alert('Invalid file'); }
  }; r.readAsText(file);
});

/* download results */
document.getElementById('downloadResults').addEventListener('click', ()=>{
  const results = JSON.parse(localStorage.getItem(RESULTS_KEY)||'[]');
  if(!results.length) return alert('No saved results.');
  // CSV
  let csv = 'Name,Grade,Section,Date,Score,Total,Timestamp\n';
  results.forEach(r=>{
    csv += `"${r.name}","${r.grade}","${r.section}","${r.date}",${r.score},${r.total},"${r.timestamp}"\n`;
  });
  const blob = new Blob([csv], {type:'text/csv'}); const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = 'eduquest_results.csv'; a.click(); URL.revokeObjectURL(a.href);
});
</script>
</body>
</html>
